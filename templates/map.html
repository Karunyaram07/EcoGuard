{% extends 'base.html' %}
{% block title %}Complaint Map{% endblock title %}
{% block body %}
<div class="container mt-4">
  <h4 class="bg-primary text-white p-2">Complaint Map</h4>
  <div id="map" style="height: 500px;"></div>
</div>

{% block scripts %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  var map = L.map('map').setView([12.97, 77.59], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {}).addTo(map);

  fetch("/api/complaints")
    .then(res => res.json())
    .then(data => {
      data.forEach(c => {
        if (c.lat && c.lng) {
          L.marker([c.lat, c.lng])
            .addTo(map)
            .bindPopup(`<b>${c.title}</b><br>${c.category}<br>Status: ${c.status}`);
        }
      });
    });
</script>
{% endblock scripts %}
{% endblock body %}
